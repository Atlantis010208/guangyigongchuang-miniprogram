## 现状与原因
- 登录逻辑已成功：`pages/auth/login/login.js:39`，并向 `login` 云函数传入 `profile.userInfo`。
- 用户昵称：`getUserProfile` 返回的默认昵称可能为“微信用户”，这是账号侧现状；云函数已将其写入 `users` 集合。
- 手机号：需点击 `open-type="getPhoneNumber"` 按钮；当前 `onGetPhoneNumber` 只把手机号写入页面状态，不立即落库，需手动点击“保存”后才入库，且在“真机调试”下可能不弹授权导致 `detail.errMsg` 非 ok。

## 代码改动方案
1. 立即落库手机号
   - 文件：`pages/auth/profile-edit/profile-edit.js`
   - 在 `onGetPhoneNumber` 成功后：
     - 读取 `userId`/`openid`
     - `db.collection('users').doc(userId).update({ data: { phoneNumber: phoneInfo.phoneNumber } })`；若无 `userId` 则按 `_openid` upsert
     - 更新本地缓存 `userDoc` 并 `this.setData({ phone: ... })`
2. 失败提示与可诊断日志
   - 在 `onGetPhoneNumber` 失败分支中，增加 `wx.showToast({ title: detail.errMsg || '手机号获取失败', icon: 'none' })`，便于判断是否为“未授权/需使用预览/体验版”。
3. 登录后的昵称保障（保持现状）
   - 目前 `login` 云函数已用 `profile.nickName || profile.nickname` 写入 `nickname`，前端 `profile-edit` 优先显示 `nickname`；无需改动。

## 环境与权限检查（操作指引，不改代码）
- 使用“预览/体验版”而非“真机调试”获取手机号。
- 确保 `getPhoneNumber` 已部署到 `cloud1-1gqerbbu347adc17`，并保有 `config.json` 的 `openapi: ["phonenumber.getPhoneNumber"]`（已存在）。
- 手机微信需绑定手机号；隐私指引已配置并发布。

## 验证流程
- 预览安装到手机，进入资料页。
- 点击“获取手机号”，应弹授权；成功后页面立刻显示手机号，且数据库 `users` 文档出现 `phoneNumber`。
- 无需点击“保存”也能看到手机号；点击“保存”仍能更新昵称/头像。

## 执行
- 获批后我将更新 `pages/auth/profile-edit/profile-edit.js` 的 `onGetPhoneNumber` 按上述方案实现并回归验证。