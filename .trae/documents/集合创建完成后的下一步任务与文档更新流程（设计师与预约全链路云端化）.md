# 总览
- 目标：在已创建 `designers` 与 `appointments` 集合基础上，完成数据填充、前端联通、预约闭环、云存储迁移、实时与监控、可选云托管，并建立每个任务“任务前/任务后”的文档更新机制。
- 交付方式：按任务序列逐一实施；每完成一个任务，立即在 `docs/backend-task-list.md` 追加两段快照：任务前（变更前状态）与任务后（变更完成与验证），并附代码定位与验证结果。

# 任务序列
## 1. 设计师数据填充
- 内容：通过控制台或导入脚本向 `designers` 集合批量写入基础字段（name、title、avatarUrl、portfolioLayout、images、rating、projectCount、pricePerSqm、hasCalcExperience、introduction、qualifications、cases、tags/specialties）。
- 验证：控制台抽样查询与 `designers_list` 云函数调用结果正确。
- 文档：追加“任务前/任务后”快照，列出字段规范与样例。

## 2. 列表页联通与筛选分页完善
- 内容：前端 `pages/designers/list/list.js` 对接 `designers_list`；完善空态、加载态、分页（page/pageSize）、筛选（spaceType/minRating/hasCalcExp）、排序（rating/projects/price）。
- 验证：本地运行多组合筛选与分页，结果与集合一致，性能稳定。
- 文档：记录接口入参/出参、UI 状态与异常处理策略。

## 3. 详情页联通与案例展示
- 内容：`pages/designers/detail/detail.js` 对接 `designer_detail`；完善头像/主图/案例图展示与缺省图处理；支持分享配置。
- 验证：抽样设计师 `id` 加载详情成功；图片展示正确。
- 文档：记录字段映射与展示逻辑。

## 4. 预约流程闭环（查询/撤销/列表）
- 内容：新增云函数 `appointments_list_by_user`、`appointments_cancel`；前端新增“我的预约”列表页或嵌入到个人中心；支持撤销流转（status：pending → canceled）。
- 验证：创建→查询→撤销→再次查询；安全与权限符合“仅创建者可读写”。
- 文档：记录状态机与接口规格。

## 5. 权限与索引复核
- 内容：控制台为 `designers` 配置“仅管理端可写，所有人可读”，为 `appointments` 配置“仅创建者可读写”；建立建议索引：
  - designers：`rating(-1)`,`projectCount(-1)`,`pricePerSqm(1)`
  - appointments：`userId(1)+createdAt(-1)`,`designerId(1)+createdAt(-1)`
- 验证：筛选与排序响应良好；批量查询与分页耗时合理。
- 文档：记录权限选择理由与索引效果。

## 6. 云存储迁移与图片链接管理
- 内容：将本地图片迁移到云存储（fileID），前端统一用 `wx.cloud.getTempFileURL`；调整 `designers.images/heroImage/avatarUrl` 字段为 `cloud://` 文件。
- 验证：页面图片均可加载；CDN 缓存命中策略合理。
- 文档：记录迁移步骤、字段变更与缓存策略建议（参考 Context7 存储与缓存文档）。

## 7. 实时能力（按需）
- 内容：为 `appointments` 增加按用户实时监听（watch），在“我的预约”页面展示动态变化；设计师列表通常无需实时。
- 验证：创建/撤销后页面自动刷新；监听稳定有退避重试。
- 文档：记录监听上限与错误处理策略。

## 8. 可选云托管后端
- 内容：完善 `cloudrun/` 服务接口，如 `/api/recommend/designers`（基于标签/评分的推荐）；如涉及支付/外部回调则实现 `/api/pay/callback`。
- 验证：`cloud.callContainer` 接入调用；日志与灰度发布验证。
- 文档：记录容器规格、路由与调用示例。

## 9. 监控与日志
- 内容：云函数调用次数/错误次数检查；重点任务（预约创建/取消、列表查询）设置日志关键字与检索语法。
- 验证：错误率与耗时达标；必要告警阈值配置。
- 文档：记录监控面板与检索语法示例。

## 10. 测试与验收
- 内容：功能测试用例（筛选/分页/详情/预约创建与撤销/图片加载/权限边界）；回归验证。
- 文档：列出测试清单与通过结果。

# 文档更新规范（每任务提交）
- 位置：`docs/backend-task-list.md` 末尾按任务顺序追加两个小节：
  - 任务前：背景、变更目标、当前状态（接口/页面/集合/权限/索引）、涉及文件路径
  - 任务后：改动摘要（代码定位/集合字段/接口入参/出参）、验证步骤与结果、注意事项
- 代码定位格式：`file_path:line_number`（例如：`pages/designers/list/list.js:32`）
- 引用 Context7：对云开发/云托管/数据库/存储相关的规范，标注库ID与主题

# 下一步执行顺序
1) 设计师数据填充 → 2) 列表页联通完善 → 3) 详情页联通 → 4) 预约列表与撤销 → 5) 权限/索引复核 → 6) 云存储迁移 → 7) 实时能力 → 8) 云托管（按需） → 9) 监控 → 10) 测试与验收。

确认后我将按以上顺序逐项实施，每完成一项即更新 MD 文档的“任务前/任务后”快照，并回报验证结果。