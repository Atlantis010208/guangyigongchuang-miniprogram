# 目标
在现有后端（云函数 + 云托管）基础上，完成前端对接、支付联调、数据与安全治理、管理后台落地以及测试与运维体系，使整体可上线与可运营。

## 前端接入与改造
- 将页面对云数据库的直接写操作迁移为调用新增云函数：`orders_*`、`requests_*`。
- 在仓库层新增可选的云函数调用适配，保持原数据结构与返回规范（`ok/code/errorMessage`）。
- 为监听与列表增加错误退避与重连策略（弱网与断网场景）。

## 支付联调（云托管）
- 在 `POST /api/pay/callback` 接入 WeChat Pay v3 验签（环境变量注入密钥/证书，不落盘）。
- 完成支付状态写回数据库（订单已支付/退款），与订单云函数保持契约一致。
- 提供沙箱联调脚本与验收用例（成功/失败/重试）。

## 云托管数据接入（管理只读）
- 将 `GET /api/admin/users|orders|requests` 接入 CloudBase Node SDK，返回真实分页数据。
- 增加基础过滤参数（用户、状态、时间区间）与简单排序（`createdAt`）。
- 为 admin 接口添加基础鉴权门槛（如临时 token 或 IP 白名单，后续接入登录体系）。

## 权限与安全治理
- 数据库权限模板：设置“仅创建者可读写”，并为云函数保留服务端写入权限。
- 统一错误码与日志结构，敏感信息不入日志；为云托管开启访问日志与告警。
- 速率限制与防刷策略（关键云函数与支付回调）。

## 监控与运维
- 云托管环境：配置灰度发布（按流量比例/URL 参数/openid 灰度）。
- 告警规则：环境创建/资源到期/费用/欠费、服务错误率与延迟阈值。
- 流水线：dev/test 自动部署，preprod/prod 手动 + 灰度；区分容器规格与副本数。

## 管理后台落地
- 独立管理前端项目对接 admin 接口：用户/订单/请求的查询与导出。
- 逐步扩展商品/分类/设计师/预约等管理 UI 与接口（写操作受控上线）。

## 测试与文档
- 用例：登录/手机号授权、订单与请求增改删、监听与列表过滤、支付回调验签与状态写回。
- 文档：完善部署与环境变量说明、接口版本约定与错误码、联调与验收步骤。

## 交付与风险
- 不引入明文秘钥；所有敏感配置均通过环境变量注入。
- 接口返回与字段保持统一，减少前端改造成本；逐步灰度上线以降低风险。

请确认上述计划，我将开始实施并同步更新代码与文档。