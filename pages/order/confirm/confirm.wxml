<view class="confirm-page">
  <view class="card unified-card">
    <text class="section-title">收货地址</text>
    <!-- 地址 -->
    <view wx:if="{{address}}" class="addr-filled" bindtap="onManageAddress">
      <view class="addr-row">
        <text class="addr-name">{{address.name}}</text>
        <text class="addr-phone">{{address.phone}}</text>
        <view class="spacer"></view>
        <view wx:if="{{address.isDefault}}" class="addr-tag">默认</view>
      </view>
      <text class="addr-detail">{{address.region.join(' ')}} {{address.town}} {{address.detail}}</text>
    </view>
    <view wx:else class="addr-empty">
      <text class="addr-empty-text">暂无默认收货地址</text>
      <view class="addr-actions">
        <button class="btn btn-light" bindtap="onAddAddress">新增地址</button>
        <button class="btn btn-dark" bindtap="onManageAddress">管理地址</button>
      </view>
    </view>

    <view class="divider"></view>

    <!-- 商品清单 -->
    <block wx:if="{{item}}">
      <view class="item-row">
        <image class="item-image" src="{{item.image}}" mode="aspectFill"></image>
        <view class="item-info">
          <text class="item-title">{{item.name}}</text>
          <text class="item-specs">{{specsText}}</text>
          <view class="qty-row"><view class="qty-btn" bindtap="decSingle">-</view><text class="qty-val">{{item.quantity}}</text><view class="qty-btn" bindtap="incSingle">+</view></view>
        </view>
        <text class="item-price">¥{{item.linePrice || (item.price * item.quantity)}}</text>
      </view>
    </block>
    <block wx:elif="{{items && items.length>0}}">
      <view class="item-row" wx:for="{{items}}" wx:key="id">
        <image class="item-image" src="{{item.image}}" mode="aspectFill"></image>
        <view class="item-info">
          <text class="item-title">{{item.name}}</text>
          <view class="qty-row"><view class="qty-btn" bindtap="decMulti" data-id="{{item.id}}">-</view><text class="qty-val">{{item.quantity}}</text><view class="qty-btn" bindtap="incMulti" data-id="{{item.id}}">+</view></view>
        </view>
        <text class="item-price">¥{{item.linePrice || (item.price * item.quantity)}}</text>
      </view>
    </block>

    <view class="divider"></view>

    <!-- 备注 -->
    <text class="section-title">备注</text>
    <textarea class="note-input" placeholder="选填，给商家留言" value="{{note}}" bindinput="onNoteInput" />

    <view class="divider"></view>

    <!-- 支付方式 -->
    <text class="section-title">支付方式</text>
    <view class="pay-row">
      <text class="pay-name">微信支付</text>
      <text class="pay-status">默认</text>
    </view>

    <view class="divider"></view>

    <!-- 费用明细 -->
    <view class="total-row"><text class="label">商品金额</text><text class="val">¥{{subtotal}}</text></view>
    <view class="total-row"><text class="label">运费</text><text class="val">¥0</text></view>
    <view class="total-row strong"><text class="label">合计</text><text class="val">¥{{total}}</text></view>
  </view>

  <view class="footer-bar">
    <view class="sum">
      <text class="sum-label">应付：</text>
      <text class="sum-price">¥{{total}}</text>
    </view>
    <button class="btn btn-primary" bindtap="onSubmit" loading="{{submitting}}" disabled="{{submitting}}">提交订单并支付</button>
  </view>

  <view class="bottom-spacer"></view>
</view>
