<scroll-view class="page" scroll-y>
  <view class="header"><text class="title">éœ€æ±‚è¿›åº¦</text></view>
  
  <!-- é¡¶éƒ¨æ­¥éª¤æ¡ï¼šå¾…ç¡®è®¤ â†’ è¿›è¡Œä¸­ â†’ å·²å®Œæˆ -->
  <view class="steps-section">
    <van-steps 
      steps="{{progressSteps}}" 
      active="{{progressActive}}"
      active-color="#007AFF"
      inactive-color="#c7c7cc"
    />
  </view>

  <view class="section">
    <view class="info">
      <view class="block-title">è®¢å•ä¿¡æ¯</view>
      
      <!-- ä¸ªæ€§éœ€æ±‚å®šåˆ¶ç±»å‹ -->
      <block wx:if="{{req.source === 'custom'}}">
        <view class="cell"><text class="label">ç±»å‹</text><text class="val">{{req.space || '-'}}</text></view>
        <view class="cell" wx:if="{{req.age}}"><text class="label">å¹´é¾„</text><text class="val">{{req.age}}</text></view>
        <view class="cell" wx:if="{{req.renoType}}"><text class="label">è£…ä¿®ç±»å‹</text><text class="val">{{req.renoType}}</text></view>
        <view class="cell"><text class="label">é£æ ¼æ„å‘</text><text class="val">{{req.service || '-'}}</text></view>
        <view class="cell"><text class="label">è£…ä¿®é¢„ç®—</text><text class="val">{{req.budget || '-'}}</text></view>
        <view class="cell"><text class="label">å¥—å†…é¢ç§¯</text><text class="val">{{req.area || '-'}}ã¡</text></view>
        <view class="cell"><text class="label">è£…ä¿®è¿›åº¦</text><text class="val">{{req.stage || '-'}}</text></view>
        <view class="cell" wx:if="{{req.layout}}"><text class="label">å¹³é¢å¸ƒç½®</text><text class="val">{{req.layout}}</text></view>
        <view class="cell" wx:if="{{req.cctPreference}}"><text class="label">è‰²æ¸©è¦æ±‚</text><text class="val">{{req.cctPreference}}</text></view>
        <view class="cell" wx:if="{{req.smartHome}}"><text class="label">æ™ºèƒ½å®¶å±…</text><text class="val">{{req.smartHome}}</text></view>
        <view class="cell" wx:if="{{req.smartLighting}}"><text class="label">æ™ºèƒ½ç¯å…‰</text><text class="val">{{req.smartLighting}}</text></view>
      </block>
      
      <!-- é€‰é…æœåŠ¡ç±»å‹ -->
      <block wx:elif="{{req.source === 'selection'}}">
        <view class="cell"><text class="label">ç±»å‹</text><text class="val">{{req.space || '-'}}</text></view>
        <view class="cell"><text class="label">ç¯å…·é¢„ç®—</text><text class="val">{{req.budget || '-'}}</text></view>
        <view class="cell"><text class="label">è£…ä¿®è¿›åº¦</text><text class="val">{{req.stage || '-'}}</text></view>
        <view class="cell" wx:if="{{req.ceilingDrop}}"><text class="label">åŠé¡¶ä¸‹åŠ</text><text class="val">{{req.ceilingDrop}}</text></view>
        <view class="cell" wx:if="{{req.bodyHeight}}"><text class="label">ç¯ä½“é«˜åº¦</text><text class="val">{{req.bodyHeight}}</text></view>
        <view class="cell" wx:if="{{req.trimless}}"><text class="label">æ— è¾¹æ¡†ç¯</text><text class="val">{{req.trimless}}</text></view>
        <view class="cell" wx:if="{{req.spotPrice}}"><text class="label">å°„ç¯ä»·ä½</text><text class="val">{{req.spotPrice}}</text></view>
        <view class="cell" wx:if="{{req.note}}"><text class="label">å¤‡æ³¨</text><text class="val">{{req.note}}</text></view>
      </block>
      
      <!-- ç¯å…‰æ–½å·¥å›¾ä¼˜åŒ–ç±»å‹ -->
      <block wx:elif="{{req.source === 'optimize'}}">
        <view class="cell"><text class="label">æœåŠ¡ç±»å‹</text><text class="val">{{req.space || 'ç¯å…‰æ–½å·¥å›¾ä¼˜åŒ–'}}</text></view>
        <view class="cell"><text class="label">ä¼˜åŒ–æ–¹å‘</text><text class="val">{{req.needsText || '-'}}</text></view>
        <view class="cell"><text class="label">æœŸæœ›äº¤ä»˜</text><text class="val">{{req.deliverablesText || '-'}}</text></view>
        <view class="cell" wx:if="{{req.note}}"><text class="label">å¤‡æ³¨è¯´æ˜</text><text class="val">{{req.note}}</text></view>
        <view class="cell" wx:if="{{req.filesCount > 0}}">
          <text class="label">ä¸Šä¼ æ–‡ä»¶</text>
          <text class="val">{{req.filesCount}} ä¸ªæ–‡ä»¶</text>
        </view>
        <!-- æ–‡ä»¶åˆ—è¡¨ -->
        <view class="files-section" wx:if="{{req.files && req.files.length > 0}}">
          <view class="file-item" wx:for="{{req.files}}" wx:key="name">
            <text class="file-icon">ğŸ“„</text>
            <view class="file-info">
              <text class="file-name">{{item.name}}</text>
              <text class="file-size">{{item.sizeText || '-'}}</text>
            </view>
          </view>
        </view>
      </block>
      
      <!-- å…¶ä»–ç±»å‹ï¼ˆå‘å¸ƒéœ€æ±‚ç­‰ï¼‰ -->
      <block wx:else>
        <view class="cell"><text class="label">ç©ºé—´</text><text class="val">{{req.space || '-'}}</text></view>
        <view class="cell"><text class="label">æœåŠ¡</text><text class="val">{{req.service || '-'}}</text></view>
        <view class="cell"><text class="label">é¢„ç®—</text><text class="val">{{req.budget || '-'}}</text></view>
        <view class="cell"><text class="label">é¢ç§¯</text><text class="val">{{req.area || '-'}}ã¡</text></view>
        <view class="cell"><text class="label">é¡¹ç›®è¿›åº¦</text><text class="val">{{req.stage || '-'}}</text></view>
        <view class="cell" wx:if="{{req.target}}"><text class="label">å†…å®¹</text><text class="val">{{req.target}}</text></view>
      </block>
      
      <!-- ğŸ”¥ è®¾è®¡å¸ˆè”ç³»æ–¹å¼ï¼ˆåªåœ¨è¿›è¡Œä¸­æˆ–å·²å®Œæˆé˜¶æ®µæ˜¾ç¤ºï¼‰ -->
      <block wx:if="{{progressActive >= 1 && (req.hasDesignerContact || req.hasCustomContact)}}">
        <view class="cell" wx:if="{{req.designerInfo.phone}}">
          <text class="label">è”ç³»æ–¹å¼(è®¾è®¡å¸ˆ)</text>
          <text 
            class="val phone longpress-copy" 
            bindlongpress="onLongPressPhone" 
            data-phone="{{req.designerInfo.phone}}"
          >{{req.designerInfo.phone}}</text>
        </view>
        <view class="cell" wx:if="{{req.designerInfo.wechat}}">
          <text class="label">å¾®ä¿¡å·</text>
          <text 
            class="val wechat longpress-copy" 
            bindlongpress="onLongPressWechat" 
            data-wechat="{{req.designerInfo.wechat}}"
          >{{req.designerInfo.wechat}}</text>
        </view>
        <view class="cell" wx:if="{{req.designerInfo.email}}">
          <text class="label">é‚®ç®±</text>
          <text 
            class="val longpress-copy" 
            bindlongpress="onLongPressEmail" 
            data-email="{{req.designerInfo.email}}"
          >{{req.designerInfo.email}}</text>
        </view>
      </block>
      
      <view class="cell"><text class="label">æäº¤æ—¶é—´ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰</text><text class="val">{{beijingTime}}</text></view>
      <text wx:if="{{req.status==='canceled'}}" class="badge cancel">å·²æ’¤é”€</text>
      <text wx:if="{{req.priority}}" class="badge priority">ä¼˜å…ˆ</text>
    </view>
    <view class="timeline">
      <view class="t-row" wx:for="{{req.steps}}" wx:key="key">
        <view class="t-dot {{item.done ? 'done' : ''}}"></view>
        <text class="t-text">{{item.label}}</text>
      </view>
    </view>
  </view>

  <view class="section actions">
    <block wx:if="{{isDesigner && req.assigned && !req.designStartConfirmed}}">
      <button class="btn primary" bindtap="onConfirmStart">ç¡®è®¤å¼€å§‹è®¾è®¡</button>
      <button class="btn ghost" bindtap="onCancelAccept">å–æ¶ˆæ¥å•</button>
    </block>
    <block wx:elif="{{isDesigner}}">
      <button class="btn primary" bindtap="onSubmitOrder" disabled="{{req.status==='canceled'}}">æäº¤è®¢å•</button>
      <button class="btn ghost" bindtap="onDesignerDone" disabled="{{req.status==='canceled'}}">å®Œæˆè®¢å•</button>
      <button class="btn ghost" bindtap="onContact">è”ç³»å®¢æœ</button>
    </block>
    <block wx:else>
      <button class="btn primary" bindtap="onGoDeposit">æŠ¼é‡‘</button>
      <button class="btn primary" bindtap="onModify" disabled="{{req.status==='canceled'}}">ä¿®æ”¹è®¢å•</button>
      <button class="btn ghost" bindtap="onContact">è”ç³»å®¢æœ</button>
      <button class="btn ghost more" bindtap="onMoreTap">
        <image class="more-icon-img" src="/images/æ›´å¤š.svg" mode="aspectFit" />
      </button>
    </block>
  </view>
</scroll-view>


