<!-- è®¾è®¡å¸ˆè¯¦æƒ…é¡µ - å‚è€ƒ ai_studio å¸ƒå±€ -->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- è®¾è®¡å¸ˆè¯¦æƒ… -->
  <view wx:elif="{{designer}}" class="detail-content">
    <!-- é¡¶éƒ¨è‹±é›„å¤§å›¾ - ä½¿ç”¨ä½œå“å›¾æˆ–å¤´åƒ -->
    <view class="hero-section">
      <image
        class="hero-image"
        src="{{designer.portfolioImages[0] || designer.avatar || '/images/ä¸ªäººä¸­å¿ƒ.png'}}"
        mode="aspectFill"
      />
      <view class="hero-gradient"></view>
    </view>

    <!-- æµ®åŠ¨çš„ä¸ªäººä¿¡æ¯å¡ç‰‡ -->
    <view class="floating-profile-card">
      <view class="profile-card-content">
        <view class="profile-header">
          <view class="profile-text">
            <text class="designer-name">{{designer.name}}</text>
            <text class="designer-subtitle">{{designer.title || 'ç…§æ˜è®¾è®¡å¸ˆ'}} | {{designer.specialties[0] || 'ç…§æ˜è®¾è®¡'}}</text>
          </view>
          <image
            class="profile-avatar"
            src="{{designer.avatar || '/images/ä¸ªäººä¸­å¿ƒ.png'}}"
            mode="aspectFill"
          />
        </view>

        <!-- ä¸‰æ ç»Ÿè®¡æ•°æ® -->
        <view class="stats-section">
          <view class="stat-item">
            <text class="stat-value">{{designer.rating || 0}}</text>
            <text class="stat-label">è¯„åˆ†</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-value">{{designer.projects || 0}}</text>
            <text class="stat-label">æˆäº¤</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-value">{{designer.experience || 0}}å¹´</text>
            <text class="stat-label">ç»éªŒ</text>
          </view>
        </view>

        <!-- è®¤è¯æ ‡ç­¾ -->
        <view class="cert-tags" wx:if="{{designer.hasCalcExp || (designer.certifications && designer.certifications.length > 0)}}">
          <view wx:if="{{designer.hasCalcExp}}" class="cert-tag cert-tag-primary">
            <text>âœ“ ç…§åº¦è®¡ç®—è®¤è¯</text>
          </view>
          <view wx:for="{{designer.certifications}}" wx:key="*this" class="cert-tag">
            <text>{{item}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¸ªäººç®€ä»‹ -->
    <view wx:if="{{designer.bio}}" class="bio-section">
      <view class="section-title">
        <text>ä¸ªäººç®€ä»‹</text>
      </view>
      <view class="bio-content">
        <text>{{designer.bio}}</text>
      </view>
    </view>

    <!-- Tab åˆ‡æ¢æ  -->
    <view class="tabs-wrapper">
      <view
        class="tab-button {{activeTab === 'works' ? 'active' : ''}}"
        bindtap="onTabChange"
        data-tab="works"
      >
        <text>ä»£è¡¨ä½œå“ ({{designer.portfolioImages.length || 0}})</text>
        <view wx:if="{{activeTab === 'works'}}" class="tab-underline"></view>
      </view>
      <view
        class="tab-button {{activeTab === 'reviews' ? 'active' : ''}}"
        bindtap="onTabChange"
        data-tab="reviews"
      >
        <text>ç”¨æˆ·è¯„ä»· ({{designer.reviews ? designer.reviews.length : 0}})</text>
        <view wx:if="{{activeTab === 'reviews'}}" class="tab-underline"></view>
      </view>
    </view>

    <!-- å†…å®¹åŒºåŸŸ -->
    <view class="content-wrapper">
      <!-- ä»£è¡¨ä½œå“ - ä½¿ç”¨ portfolioImages æ•°ç»„ -->
      <view wx:if="{{activeTab === 'works'}}" class="works-content">
        <view wx:if="{{designer.portfolioImages && designer.portfolioImages.length > 0}}" class="portfolio-grid">
          <view
            wx:for="{{designer.portfolioImages}}"
            wx:key="index"
            class="portfolio-item"
            bindtap="previewImage"
            data-url="{{item}}"
            data-urls="{{designer.portfolioImages}}"
          >
            <image
              class="portfolio-image"
              src="{{item}}"
              mode="aspectFill"
            />
          </view>
        </view>

        <view wx:else class="empty-content">
          <text class="empty-text">æš‚æ— ä½œå“å±•ç¤º</text>
        </view>
      </view>

      <!-- ç”¨æˆ·è¯„ä»· -->
      <view wx:if="{{activeTab === 'reviews'}}" class="reviews-content">
        <view wx:if="{{designer.reviews && designer.reviews.length > 0}}" class="review-list">
          <view wx:for="{{designer.reviews}}" wx:key="date" class="review-card">
            <view class="review-header">
              <text class="review-user">{{item.user}}</text>
              <view class="review-rating">
                <text class="star">â˜…</text>
                <text class="rating-num">{{item.rating}}</text>
              </view>
            </view>
            <text class="review-content">{{item.content}}</text>
            <text class="review-date">{{item.date}}</text>
          </view>
        </view>

        <view wx:else class="empty-content">
          <text class="empty-text">æš‚æ— ç”¨æˆ·è¯„ä»·</text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨å ä½ -->
    <view class="bottom-spacer"></view>
  </view>

  <!-- æœªæ‰¾åˆ°è®¾è®¡å¸ˆ -->
  <view wx:else class="empty-state">
    <text class="empty-text">æœªæ‰¾åˆ°è¯¥è®¾è®¡å¸ˆ</text>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view wx:if="{{!loading && designer}}" class="action-bar">
    <view class="customer-service" bindtap="onContact">
      <image class="service-icon-img" src="/images/å®¢æœ.png" mode="aspectFit" />
      <text class="service-text">å®¢æœ</text>
    </view>
    <view class="action-buttons">
      <view class="consult-btn" bindtap="onConsult">
        <text>ç§ä¿¡å’¨è¯¢</text>
      </view>
      <view class="book-btn" bindtap="openBooking">
        <text>ç«‹å³é¢„çº¦</text>
        <text class="arrow">â†’</text>
      </view>
    </view>
  </view>

  <!-- é¢„çº¦å¼¹çª— -->
  <view wx:if="{{showBookingModal}}" class="modal-mask" catchtap="closeBooking">
    <view class="modal-content" catchtap="noop">
      <view class="modal-header">
        <text class="modal-title">é¢„çº¦è®¾è®¡å¸ˆ</text>
        <view class="modal-close" catchtap="closeBooking">âœ•</view>
      </view>

      <view class="modal-body">
        <!-- åŠ è½½ä¸­ -->
        <view wx:if="{{loadingRequests}}" class="loading-hint">
          <text>åŠ è½½éœ€æ±‚ä¸­...</text>
        </view>
        
        <!-- å…³è”éœ€æ±‚é€‰æ‹© -->
        <block wx:elif="{{userRequests.length > 0}}">
          <view class="form-item">
            <text class="form-label">å…³è”éœ€æ±‚</text>
            <picker bindchange="onRequestChange" value="{{selectedRequestIndex}}" range="{{userRequests}}" range-key="title">
              <view class="picker-value">
                <text class="picker-text selected">{{selectedRequest.title || 'è¯·é€‰æ‹©'}}</text>
                <text class="picker-arrow">â€º</text>
              </view>
            </picker>
          </view>
          
          <!-- è‡ªåŠ¨å¡«å……çš„ä¿¡æ¯ï¼ˆåªè¯»å±•ç¤ºï¼‰ -->
          <view class="auto-fill-info" wx:if="{{selectedRequest}}">
            <view class="info-row">
              <text class="info-label">ç©ºé—´ç±»å‹</text>
              <text class="info-value">{{selectedRequest.spaceType || '-'}}</text>
            </view>
            <view class="info-row">
              <text class="info-label">è®¾è®¡é¢ç§¯</text>
              <text class="info-value">{{selectedRequest.area || '-'}}ã¡</text>
            </view>
            <view class="info-row">
              <text class="info-label">é¢„ç®—èŒƒå›´</text>
              <text class="info-value">{{selectedRequest.budget || '-'}}</text>
            </view>
          </view>
        </block>
        
        <!-- æ— éœ€æ±‚æç¤º -->
        <view wx:else class="no-request-hint">
          <text class="hint-icon">ğŸ“‹</text>
          <text class="hint-text">æ‚¨è¿˜æ²¡æœ‰å‘å¸ƒç…§æ˜éœ€æ±‚</text>
          <text class="hint-sub">é¢„çº¦åå°†è‡ªåŠ¨å…³è”æ‚¨çš„éœ€æ±‚ä¿¡æ¯</text>
        </view>

        <!-- åˆ†éš”çº¿ -->
        <view class="form-divider"></view>

        <!-- è”ç³»æ–¹å¼ç±»å‹ -->
        <view class="form-item">
          <text class="form-label">è”ç³»æ–¹å¼ <text class="form-label-required">*</text></text>
          <picker bindchange="onContactTypeChange" value="{{contactTypeIndex}}" range="{{contactTypeOptions}}">
            <view class="picker-value">
              <text class="picker-text {{bookingForm.contactType ? 'selected' : 'placeholder'}}">
                {{bookingForm.contactType || 'è¯·é€‰æ‹©'}}
              </text>
              <text class="picker-arrow">â€º</text>
            </view>
          </picker>
        </view>

        <!-- è”ç³»æ–¹å¼å†…å®¹ -->
        <view class="form-item">
          <text class="form-label">{{bookingForm.contactType || 'è”ç³»æ–¹å¼'}}å·ç  <text class="form-label-required">*</text></text>
          <input
            class="form-input"
            type="text"
            placeholder="{{bookingForm.contactType ? 'è¯·è¾“å…¥æ‚¨çš„' + bookingForm.contactType : 'è¯·å…ˆé€‰æ‹©è”ç³»æ–¹å¼'}}"
            placeholder-class="input-placeholder"
            value="{{bookingForm.contact}}"
            bindinput="onContactInput"
          />
        </view>

        <!-- å¤‡æ³¨ -->
        <view class="form-item">
          <text class="form-label">å¤‡æ³¨ <text class="form-label-hint">ï¼ˆé€‰å¡«ï¼‰</text></text>
          <textarea
            class="form-textarea"
            placeholder="è¯·æè¿°æ‚¨çš„éœ€æ±‚æˆ–ç‰¹æ®Šè¦æ±‚"
            placeholder-class="textarea-placeholder"
            value="{{bookingForm.remark}}"
            bindinput="onRemarkInput"
            maxlength="200"
          />
        </view>
      </view>

      <view class="modal-footer">
        <view class="submit-btn" bindtap="submitBooking">
          <text>æäº¤é¢„çº¦</text>
        </view>
      </view>
    </view>
  </view>
</view>
