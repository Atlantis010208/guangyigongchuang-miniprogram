<!-- è®¾è®¡å¸ˆè¯¦æƒ…é¡µ - å‚è€ƒ ai_studio å¸ƒå±€ -->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- è®¾è®¡å¸ˆè¯¦æƒ… -->
  <view wx:else class="detail-content">
    <!-- é¡¶éƒ¨è‹±é›„å¤§å›¾ -->
    <view class="hero-section">
      <image
        class="hero-image"
        src="{{designer.heroImage || '/images/ä¸ªäººä¸­å¿ƒ.png'}}"
        mode="aspectFill"
      />
      <view class="hero-gradient"></view>
    </view>

    <!-- æµ®åŠ¨çš„ä¸ªäººä¿¡æ¯å¡ç‰‡ -->
    <view class="floating-profile-card">
      <view class="profile-card-content">
        <view class="profile-header">
          <view class="profile-text">
            <text class="designer-name">{{designer.name}}</text>
            <text class="designer-subtitle">{{designer.title}} | {{designer.specialties[0] || 'æç®€'}}ä¸»ä¹‰è€…</text>
          </view>
          <image
            class="profile-avatar"
            src="{{designer.avatarUrl}}"
            mode="aspectFill"
          />
        </view>

        <!-- ä¸‰æ ç»Ÿè®¡æ•°æ® -->
        <view class="stats-section">
          <view class="stat-item">
            <text class="stat-value">{{designer.rating}}</text>
            <text class="stat-label">è¯„åˆ†</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-value">{{designer.projectCount}}</text>
            <text class="stat-label">æˆäº¤</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-value">{{designer.experienceYears || 8}}å¹´</text>
            <text class="stat-label">ç»éªŒ</text>
          </view>
        </view>
      </view>
    </view>

    <!-- Tab åˆ‡æ¢æ  -->
    <view class="tabs-wrapper">
      <view
        class="tab-button {{activeTab === 'works' ? 'active' : ''}}"
        bindtap="onTabChange"
        data-tab="works"
      >
        <text>ä»£è¡¨ä½œå“</text>
        <view wx:if="{{activeTab === 'works'}}" class="tab-underline"></view>
      </view>
      <view
        class="tab-button {{activeTab === 'reviews' ? 'active' : ''}}"
        bindtap="onTabChange"
        data-tab="reviews"
      >
        <text>ç”¨æˆ·è¯„ä»· ({{designer.reviews ? designer.reviews.length : 42}})</text>
        <view wx:if="{{activeTab === 'reviews'}}" class="tab-underline"></view>
      </view>
    </view>

    <!-- å†…å®¹åŒºåŸŸ -->
    <view class="content-wrapper">
      <!-- ä»£è¡¨ä½œå“ -->
      <view wx:if="{{activeTab === 'works'}}" class="works-content">
        <view wx:if="{{designer.cases && designer.cases.length > 0}}" class="portfolio-grid">
          <view
            wx:for="{{designer.cases}}"
            wx:key="title"
            class="portfolio-item {{item.span === 2 ? 'span-2' : ''}}"
          >
            <image
              class="portfolio-image"
              src="{{item.coverUrl}}"
              mode="aspectFill"
            />
            <view class="portfolio-overlay">
              <text class="portfolio-title">{{item.title}}</text>
            </view>
            <view wx:if="{{item.hasGallery}}" class="gallery-icon">
              <text>ğŸ–¼</text>
            </view>
          </view>
        </view>

        <view wx:else class="empty-content">
          <text class="empty-text">æš‚æ— ä½œå“å±•ç¤º</text>
        </view>
      </view>

      <!-- ç”¨æˆ·è¯„ä»· -->
      <view wx:if="{{activeTab === 'reviews'}}" class="reviews-content">
        <view wx:if="{{designer.reviews && designer.reviews.length > 0}}" class="review-list">
          <view wx:for="{{designer.reviews}}" wx:key="date" class="review-card">
            <view class="review-header">
              <text class="review-user">{{item.user}}</text>
              <view class="review-rating">
                <text class="star">â˜…</text>
                <text class="rating-num">{{item.rating}}</text>
              </view>
            </view>
            <text class="review-content">{{item.content}}</text>
            <text class="review-date">{{item.date}}</text>
          </view>
        </view>

        <view wx:else class="empty-content">
          <text class="empty-text">æš‚æ— ç”¨æˆ·è¯„ä»·</text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨å ä½ -->
    <view class="bottom-spacer"></view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view wx:if="{{!loading}}" class="action-bar">
    <view class="customer-service" bindtap="onContact">
      <image class="service-icon-img" src="/images/å®¢æœ.png" mode="aspectFit" />
      <text class="service-text">å®¢æœ</text>
    </view>
    <view class="action-buttons">
      <view class="consult-btn" bindtap="onConsult">
        <text>ç§ä¿¡å’¨è¯¢</text>
      </view>
      <view class="book-btn" bindtap="openBooking">
        <text>ç«‹å³é¢„çº¦</text>
        <text class="arrow">â†’</text>
      </view>
    </view>
  </view>

  <!-- é¢„çº¦å¼¹çª— -->
  <view wx:if="{{showBookingModal}}" class="modal-mask" catchtap="closeBooking">
    <view class="modal-content" catchtap="noop">
      <view class="modal-header">
        <text class="modal-title">é¢„çº¦è®¾è®¡å¸ˆ</text>
        <view class="modal-close" catchtap="closeBooking">âœ•</view>
      </view>

      <view class="modal-body">
        <!-- ç©ºé—´ç±»å‹ -->
        <view class="form-item">
          <text class="form-label">ç©ºé—´ç±»å‹</text>
          <picker bindchange="onSpaceChange" value="{{spaceIndex}}" range="{{spaceOptions}}">
            <view class="picker-value">
              <text class="{{bookingForm.spaceType ? 'selected' : 'placeholder'}}">
                {{bookingForm.spaceType || 'è¯·é€‰æ‹©ç©ºé—´ç±»å‹'}}
              </text>
              <text class="arrow">â€º</text>
            </view>
          </picker>
        </view>

        <!-- è®¾è®¡é¢ç§¯ -->
        <view class="form-item">
          <text class="form-label">è®¾è®¡é¢ç§¯</text>
          <input
            class="form-input"
            type="digit"
            placeholder="è¯·è¾“å…¥é¢ç§¯ï¼ˆã¡ï¼‰"
            value="{{bookingForm.area}}"
            bindinput="onAreaInput"
          />
        </view>

        <!-- é¢„ç®—èŒƒå›´ -->
        <view class="form-item">
          <text class="form-label">é¢„ç®—èŒƒå›´</text>
          <picker bindchange="onBudgetChange" value="{{budgetIndex}}" range="{{budgetOptions}}">
            <view class="picker-value">
              <text class="{{bookingForm.budget ? 'selected' : 'placeholder'}}">
                {{bookingForm.budget || 'è¯·é€‰æ‹©é¢„ç®—èŒƒå›´'}}
              </text>
              <text class="arrow">â€º</text>
            </view>
          </picker>
        </view>

        <!-- è”ç³»æ–¹å¼ç±»å‹ -->
        <view class="form-item">
          <text class="form-label">è”ç³»æ–¹å¼</text>
          <picker bindchange="onContactTypeChange" value="{{contactTypeIndex}}" range="{{contactTypeOptions}}">
            <view class="picker-value">
              <text class="{{bookingForm.contactType ? 'selected' : 'placeholder'}}">
                {{bookingForm.contactType || 'è¯·é€‰æ‹©è”ç³»æ–¹å¼ç±»å‹'}}
              </text>
              <text class="arrow">â€º</text>
            </view>
          </picker>
        </view>

        <!-- è”ç³»æ–¹å¼å†…å®¹ -->
        <view class="form-item">
          <text class="form-label">{{bookingForm.contactType || 'è”ç³»æ–¹å¼'}}å·ç </text>
          <input
            class="form-input"
            type="text"
            placeholder="{{bookingForm.contactType ? 'è¯·è¾“å…¥' + bookingForm.contactType + 'å·ç ' : 'è¯·å…ˆé€‰æ‹©è”ç³»æ–¹å¼ç±»å‹'}}"
            value="{{bookingForm.contact}}"
            bindinput="onContactInput"
          />
        </view>

        <!-- å¤‡æ³¨ -->
        <view class="form-item">
          <text class="form-label">å¤‡æ³¨</text>
          <textarea
            class="form-textarea"
            placeholder="è¯·æè¿°æ‚¨çš„éœ€æ±‚æˆ–ç‰¹æ®Šè¦æ±‚ï¼ˆé€‰å¡«ï¼‰"
            value="{{bookingForm.remark}}"
            bindinput="onRemarkInput"
            maxlength="200"
          />
        </view>
      </view>

      <view class="modal-footer">
        <view class="submit-btn" bindtap="submitBooking">
          <text>æäº¤é¢„çº¦</text>
        </view>
      </view>
    </view>
  </view>
</view>
